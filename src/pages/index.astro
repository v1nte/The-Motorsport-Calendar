---
import Layout from "../layouts/Layout.astro";
import EventCard from "../components/EventCard.astro";
import MonthCard from "../components/MonthCard.astro";
import { getSortedEvents } from "../utils/events.ts";

const events = getSortedEvents();
let lastMonth = new Date("2025-01-01").getMonth();
---

<Layout>
  <main
    class="grid grid-cols-1 sm:grid-cols-2 md:mx-32 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 p-4 gap-8 place-items-center"
  >
    {
      events.map((event) => {
        const eventMonth = new Date(event.dates.mainEvent).getMonth();
        const monthName = new Date(event.dates.mainEvent).toLocaleString(
          "en-US",
          {
            month: "long",
          },
        );

        const isNewMonth = eventMonth !== lastMonth;
        <div class="flex col-span-full">
          <MonthCard monthName={monthName} loading="eager" />
        </div>;

        if (isNewMonth) {
          lastMonth = eventMonth;
          return (
            <>
              <div class="flex col-span-full">
                <MonthCard monthName={monthName} loading="lazy" />
              </div>
              <EventCard
                name={event.commonName}
                circuit={event.circuit}
                fullName={event.officialName}
                dates={event.dates}
                logo={event.logo}
                location={event.location}
                lazy={true}
              />
            </>
          );
        }

        return (
          <EventCard
            name={event.commonName}
            circuit={event.circuit}
            fullName={event.officialName}
            dates={event.dates}
            logo={event.logo}
            location={event.location}
            lazy={false}
          />
        );
      })
    }
  </main>
</Layout>
